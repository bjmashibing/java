# 03 楼盘管理

### 1、新增住宅向导-Step1

​		本模块来完成新增住宅向导的功能

​		1、当点击新增住宅向导之后，需要添加查询相关的公司数据作为下拉列表的展示,添加前端请求

创建新的请求文件

estate.js

```js
import { axios } from '@/utils/request'

export function selectCompany() {
    return axios({
        url: '/estate/selectCompany',
        method: 'get'
    })
}

export function insertEstate(params) {
    return axios({
        url: '/estate/insertEstate',
        method: 'post',
        data: params
    })
}

```

```js
<script>
    import { insertEstate, selectCompany } from '@/api/estate'
    const QS = require('qs')
    export default {
        name: 'Step1',
        data() {
            return {
                select: [],
                labelCol: { lg: { span: 6 }, sm: { span: 4 } },
                wrapperCol: { lg: { span: 16 }, sm: { span: 20 } },
                form: {
                    company: [],
                    estateCode: '',
                    estateName: '',
                    coverArea: '',
                    buildArea: '',
                    greenArea: '',
                    roadArea: '',
                    buildingNumber: '',
                    buildingLeader: '',
                    estateAddr: '',
                    companyName: '',
                    companyBehalf: '',
                    contact: '',
                    contactPhone: '',
                    remark: ''
                },
                rules: {
                    estateCode: [
                        { required: true, message: '住宅编码必须填写', trigger: 'blur' }
                        // { min: 3, max: 5, message: 'Length should be 3 to 5', trigger: 'blur' }
                    ],
                    company: [{ required: true, message: '所属公司必须填写', trigger: 'change' }],
                    estateName: [{ required: true, message: '住宅名称必须填写', trigger: 'blur' }],
                    buildingNumber: [
                        {
                            required: true,
                            message: '楼宇数量必须填写',
                            trigger: 'change'
                        },
                        { min: 1, max: 20, type: 'number', message: 'Length should be 1 to 20', trigger: 'change' }
                    ]
                }
            }
        },
        created() {
            selectCompany().then(res => {
                    this.select = res.result
                }).catch(err => {
                this.$notification['error']({
                    message: '错误',
                    description: ((err.response || {}).data || {}).message || '获取公司信息失败',
                    duration: 4
                })
            })
        },
        methods: {
            nextStep() {
                this.$refs.ruleForm.validate(valid => {
                    if (valid) {
                        const data = QS.stringify(this.form)
                        insertEstate(data).then(res => {
                            if (res.message === '1') {
                                setTimeout(() => {
                                    this.$notification.success({
                                        message: '恭喜你',
                                        description: res.result
                                    })
                                }, 1000)
                                this.$store.commit('SET_TITLE', {
                                    buildingNumber: this.form.buildingNumber,
                                    estateCode: this.form.estateCode
                                })
                                this.$emit('nextStep')
                            } else {
                                setTimeout(() => {
                                    this.$notification.error({
                                        message: '抱歉',
                                        description: res.result
                                    })
                                }, 1000)
                            }
                        }
                        ).catch(err => {
                            this.$notification.error({
                                message: err.result,
                                description: ((err.response || {}).data || {}).message || '插入房产信息失败',
                                duration: 1
                            })
                        })
                    } else {
                        console.log('error submit!!')
                        return false
                    }
                })
            },
            resetForm() {
                this.$refs.ruleForm.resetFields()
                console.log(this.$refs.ruleForm.resetFields)
            }
        }
    }
</script>
```

​		2、编写后端逻辑

EstateController.java

```java
package com.bjmsb.controller;

import com.alibaba.fastjson.JSONObject;
import com.bjmsb.bean.FcEstate;
import com.bjmsb.json.Common;
import com.bjmsb.service.EstateService;
import com.bjmsb.service.common.FcEstateService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
//@CrossOrigin(origins = "*",allowCredentials="true",allowedHeaders = "*",methods = {})
public class EstateController {

    @Autowired
    private EstateService estateService;

    @RequestMapping("/estate/selectCompany")
    public JSONObject selectCompany(){
        System.out.println("/estate/selectCompany");
        List<String> tblCompanyNames = estateService.selectCompany();
        return JSONObject.parseObject(JSONObject.toJSONString(new Common(tblCompanyNames)));
    }

    @RequestMapping("/estate/insertEstate")
    public JSONObject insertEstate(FcEstate fcEstate){
        System.out.println("insert estate");
        Integer result = estateService.insertEstate(fcEstate);
        if (result==0){
            return JSONObject.parseObject(JSONObject.toJSONString(new Common("房产编码已存在","0")));
        }else{
            return JSONObject.parseObject(JSONObject.toJSONString(new Common("插入房产成功","1")));
        }
    }
}
```

EstateService.java

```java
package com.bjmsb.service;

import com.bjmsb.bean.FcEstate;
import com.bjmsb.bean.TblCompany;
import com.bjmsb.mapper.FcEstateMapper;
import com.bjmsb.mapper.TblCompanyMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class EstateService {

    @Autowired
    private TblCompanyMapper tblCompanyMapper;

    @Autowired
    private FcEstateMapper fcEstateMapper;

    public List<String> selectCompany(){
        List<String> tblCompanies = tblCompanyMapper.selectCompany();
        return tblCompanies;
    }

    /**
     * 在此逻辑中需要先做判断，判断数据库中是否已经存在编码，如果存在，那么对用户发出提示
     * @param fcEstate
     * @return
     */
    public Integer insertEstate(FcEstate fcEstate){
        int result = 0;
        QueryWrapper<FcEstate> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("estate_code", fcEstate.getEstateCode());
        FcEstate fe = fcEstateMapper.selectOne(queryWrapper);
        if (fe==null){
            result = fcEstateMapper.insert(fcEstate);
        }
        return result;
    }
}
```

TblCompanyMapper.java

```java
@Component
public interface TblCompanyMapper extends BaseMapper<TblCompany> {

    public List<String> selectCompany();
}
```

TblCompanyMapper.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bjmsb.mapper.TblCompanyMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.bjmsb.bean.TblCompany">
        <id column="id" property="id" />
        <result column="company_full_name" property="companyFullName" />
        <result column="company_simple_name" property="companySimpleName" />
        <result column="company_english_name" property="companyEnglishName" />
        <result column="company_brand" property="companyBrand" />
        <result column="company_type" property="companyType" />
        <result column="company_trade" property="companyTrade" />
        <result column="company_addr" property="companyAddr" />
        <result column="post_code" property="postCode" />
        <result column="company_phone" property="companyPhone" />
        <result column="company_fax" property="companyFax" />
        <result column="company_website" property="companyWebsite" />
        <result column="company_email" property="companyEmail" />
        <result column="company_national" property="companyNational" />
        <result column="company_land" property="companyLand" />
        <result column="open_bank" property="openBank" />
        <result column="bank_account" property="bankAccount" />
        <result column="company_leader" property="companyLeader" />
        <result column="register_date" property="registerDate" />
        <result column="register_money" property="registerMoney" />
        <result column="employee_number" property="employeeNumber" />
        <result column="company_intro" property="companyIntro" />
        <result column="remark" property="remark" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, company_full_name, company_simple_name, company_english_name, company_brand, company_type, company_trade, company_addr, post_code, company_phone, company_fax, company_website, company_email, company_national, company_land, open_bank, bank_account, company_leader, register_date, register_money, employee_number, company_intro, remark
    </sql>

    <!--查询所有的公司名称-->
    <select id="selectCompany" resultType="String">
        select company_full_name from tbl_company
    </select>
</mapper>

```

FcEstateMapper.java

```java
@Component
public interface FcEstateMapper extends BaseMapper<FcEstate> {

}
```

FcEstateMapper.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bjmsb.mapper.FcEstateMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.bjmsb.bean.FcEstate">
        <id column="id" property="id" />
        <result column="estate_code" property="estateCode" />
        <result column="estate_name" property="estateName" />
        <result column="estate_addr" property="estateAddr" />
        <result column="cover_area" property="coverArea" />
        <result column="build_area" property="buildArea" />
        <result column="green_area" property="greenArea" />
        <result column="road_area" property="roadArea" />
        <result column="building_number" property="buildingNumber" />
        <result column="building_leader" property="buildingLeader" />
        <result column="company_name" property="companyName" />
        <result column="company_behalf" property="companyBehalf" />
        <result column="contact" property="contact" />
        <result column="contact_phone" property="contactPhone" />
        <result column="contact_addr" property="contactAddr" />
        <result column="car_space_delay_rate" property="carSpaceDelayRate" />
        <result column="car_space_over_day" property="carSpaceOverDay" />
        <result column="estate_type" property="estateType" />
        <result column="street_lamp_number" property="streetLampNumber" />
        <result column="hfcNum" property="hfcNum" />
        <result column="remark" property="remark" />
        <result column="company" property="company" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, estate_code, estate_name, estate_addr, cover_area, build_area, green_area, road_area, building_number, building_leader, company_name, company_behalf, contact, contact_phone, contact_addr, car_space_delay_rate, car_space_over_day, estate_type, street_lamp_number, hfcNum, remark, company
    </sql>
</mapper>
```

### 2、Step1-Step2数据传递问题

​		当完成第二个页面的跳转之后，大家发现了一个问题，在页面的最上面会引入一个楼宇的数量，我们很明显的知道楼宇的数据来源于step1中设置的值，那么问题就来了，如何把第一个页面设置的值传递到第二个页面呢？这里我们使用vuex这样一个组件来完成具体的功能。

1、在step1中实现页面跳转之前，我们需要实现如下的定义：

```js
 this.$store.commit('SET_TITLE',{
                        buildingNumber: this.form.buildingNumber
                    })
                    this.$emit('nextStep')
```

2、在store目录下创建一个新的文件叫做oneStep.js的文件，定义如下内容

```js
const oneStep = {
    state: {
        buildingNumber: ''
    },
    mutations: {
        // 这里只能是同步的
        SET_TITLE(state, payload) {
            console.log(payload)
            state.buildingNumber = payload.buildingNumber
        }
    },
    actions: {

    },
    getters: {

    }
}
export default oneStep
```

3、在下面的index.js文件中将定义好的oneStep定义成一个模块

```js
import Vue from 'vue'
import Vuex from 'vuex'

import app from './modules/app'
import user from './modules/user'
// default router permission control
import permission from './modules/permission'
import oneStep from './modules/oneStep'
// dynamic router permission control (Experimental)
// import permission from './modules/async-router'
import getters from './getters'

Vue.use(Vuex)

export default new Vuex.Store({
  modules: {
    app,
    user,
    permission,
    oneStep
  },
  state: {

  },
  mutations: {

  },
  actions: {

  },
  getters
})
```

4、在step2.vue中添加如下代码进行引入

```js
  <span style="color: blue;font-weight: 700;">{{ this.$store.state.oneStep.buildingNumber }}</span>
```

### 3、新增住宅向导-Step2

​		下面开始来完成Step2的功能，其实这部分看起来是比较简单的，但是你需要注意了正儿八经开始做的时候，你就要疯了，原因也很简单，我们在Step1的时候设置过楼宇的数量，那么就意味着数据库中就应该由与之对应的数据库表记录，此时你发现数据库是空的，因此这种时候，我们需要先完成插入的功能，然后再完成数据更新的过程。

1、修改页面Step2.vue文件，添加如下代码

```vue
<template>
    <div>
        <a-row class="header">
            楼宇数量:
            <span style="color: blue;font-weight: 700;">{{ this.$store.state.oneStep.buildingNumber }}</span>
                        单元数量:
            <a-select v-model="form2.region" @change="change()">
                <a-select-option value="1">1</a-select-option>
                <a-select-option value="2">2</a-select-option>
                <a-select-option value="3">3</a-select-option>
                <a-select-option value="4">4</a-select-option>
                <a-select-option value="5">5</a-select-option>
            </a-select>
        </a-row>
        <a-row>
            <a-table :columns="columns" :dataSource="data" align="center" bordered>
                <template
                    :slot="col"
                    slot-scope="text, record"
                    v-for="col in [
            'buildingCode',
            'buildingName',
            'unitCount',
            'overRoofDate',
            'finishDate',
            'salePermissionId',
            'buildPermissionId',
            'buildArea',
            'usedArea',
            'remark'
          ]"
                >
                    <div :key="col">
                        <a-input
                            :value="text"
                            @change="e => handleChange(e.target.value, record.key, col)"
                            style="margin: -5px 0"
                            v-if="record.editable"
                        />
                        <template v-else>{{ text }}</template>
                    </div>
                </template>
                <template slot="operation" slot-scope="text, record">
                    <div class="editable-row-operations">
            <span v-if="record.editable">
              <a @click="() => save(record.key)">保存</a>
              <a-popconfirm @confirm="() => cancel(record.key)" title="确认取消吗?">
                <a>取消</a>
              </a-popconfirm>
            </span>
                        <span v-else>
              <a :disabled="editingKey !== ''" @click="() => edit(record.key)">编辑</a>
            </span>
                    </div>
                </template>
            </a-table>
            <a-row>
                <a-button @click="nextStep()" type="primary">下一步</a-button>
            </a-row>
        </a-row>
    </div>
</template>

<script>
    import { selectBuilding, updateBuilding } from '@/api/estate'
    // import moment from 'moment'
    const QS = require('qs')
    const columns = [
        {
            align: 'center',
            title: '楼宇编码',
            dataIndex: 'buildingCode',
            width: '6%',
            scopedSlots: { customRender: 'buildingCode' }
        },
        {
            align: 'center',
            title: '楼宇名称',
            dataIndex: 'buildingName',
            width: '15%',
            scopedSlots: { customRender: 'buildingName' }
        },
        {
            align: 'center',
            title: '单元数量',
            dataIndex: 'unitCount',
            width: '6%',
            scopedSlots: { customRender: 'unitCount' }
        },
        {
            align: 'center',
            title: '封顶日期',
            dataIndex: 'overRoofDate',
            width: '7%',
            scopedSlots: { customRender: 'overRoofDate' }
        },
        {
            align: 'center',
            title: '竣工日期',
            dataIndex: 'finishDate',
            width: '7%',
            scopedSlots: { customRender: 'finishDate' }
        },
        {
            align: 'center',
            title: '预售许可证',
            dataIndex: 'salePermissionId',
            width: '7%',
            scopedSlots: { customRender: 'salePermissionId' }
        },
        {
            align: 'center',
            title: '建筑许可证',
            dataIndex: 'buildPermissionId',
            width: '7%',
            scopedSlots: { customRender: 'buildPermissionId' }
        },
        {
            align: 'center',
            title: '建筑面积',
            dataIndex: 'buildArea',
            width: '6%',
            scopedSlots: { customRender: 'buildArea' }
        },
        {
            align: 'center',
            title: '使用面积',
            dataIndex: 'usedArea',
            width: '6%',
            scopedSlots: { customRender: 'usedArea' }
        },
        {
            align: 'center',
            title: '备注',
            dataIndex: 'remark',
            width: '10%',
            scopedSlots: { customRender: 'remark' }
        },
        {
            align: 'center',
            title: '编辑',
            width: '4%',
            dataIndex: 'operation',
            scopedSlots: { customRender: 'operation' }
        }
    ]

    const data = []
    export default {
        name: 'Step2',
        data() {
            return {
                labelCol: { span: 2 },
                wrapperCol: { span: 1 },
                form2: {
                    name: '',
                    region: undefined,
                    date1: undefined,
                    delivery: false,
                    type: [],
                    resource: '',
                    desc: ''
                },
                data,
                columns,
                editingKey: ''
                // labelCol: { lg: { span: 5 }, sm: { span: 5 } },
                // wrapperCol: { lg: { span: 19 }, sm: { span: 19 } },
                // form: this.$form.createForm(this),
                // loading: false,
                // timer: 0
            }
        },
        created() {
            const allData = {
                buildingNumber: this.$store.state.oneStep.buildingNumber,
                estateCode: this.$store.state.oneStep.estateCode
            }
            const params = QS.stringify(allData)
            selectBuilding(params).then(res => {
                const result = res.result
                for (let i = 0; i < result.length; i++) {
                    const building = result[i]
                    data.push({
                        key: building.id.toString(),
                        buildingCode: building.buildingCode,
                        buildingName: building.buildingName,
                        unitCount: building.unitCount,
                        overRoofDate: building.overRoofDate,
                        finishDate: building.finishDate,
                        salePermissionId: building.salePermissionId,
                        buildPermissionId: building.buildPermissionId,
                        buildArea: building.buildArea,
                        usedArea: building.usedArea,
                        remark: building.remark
                    })
                }
                this.cacheData = data.map(item => ({ ...item }))
            }).catch(err => {
                this.$notification['error']({
                    message: '错误',
                    description: ((err.response || {}).data || {}).message || '获取楼宇信息失败',
                    duration: 4
                })
            })
        },
        methods: {
            change() {
                const unitNumber = this.form2.region
                for (let i = 0; i< this.data.length; i++) {
                    this.data[i].unitCount = unitNumber
                }
            },
            nextStep() {
                const dataArray = this.data
                var param = '['
                for (let i = 0; i < dataArray.length; i++) {
                    if (i !== dataArray.length - 1) {
                        param += '{ "buildingCode": "' + dataArray[i].buildingCode + '", "unitCount": ' + dataArray[i].unitCount + '},'
                    } else {
                        param += '{ "buildingCode": "' + dataArray[i].buildingCode + '", "unitCount": ' + dataArray[i].unitCount + '}]'
                    }
                }

                this.$store.commit('SET_TITLE', {
                    unitMessage: param
                })
                this.$emit('nextStep')
            },
            prevStep() {
                // this.$emit('prevStep')
            },
            handleChange(value, key, column) {
                const newData = [...this.data]
                const target = newData.filter(item => key === item.key)[0]
                if (target) {
                    target[column] = value
                    this.data = newData
                }
            },
            edit(key) {
                const newData = [...this.data]
                const target = newData.filter(item => key === item.key)[0]
                this.editingKey = key
                if (target) {
                    target.editable = true
                    this.data = newData
                    this.editingKey = ''
                }
            },
            save(key) {
                const newData = [...this.data]
                const newCacheData = [...this.cacheData]
                const target = newData.filter(item => key === item.key)[0]
                const targetCache = newCacheData.filter(item => key === item.key)[0]
                if (target && targetCache) {
                    delete target.editable
                    this.data = newData
                    Object.assign(targetCache, target)
                    this.cacheData = newCacheData
                }
                target.id = key
                target.estateCode = this.$store.state.oneStep.estateCode
                const param = QS.stringify(target)
                updateBuilding(param).then(res => {
                    setTimeout(() => {
                        this.$notification.success({
                            message: '恭喜你',
                            description: res.result
                        })
                    }, 1000)
                }).catch(err => {
                    this.$notification.error({
                        message: 'error',
                        description: ((err.response || {}).data || {}).message || '添加楼宇信息失败',
                        duration: 1
                    })
                })
            },
            cancel(key) {
                const newData = [...this.data]
                const target = newData.filter(item => key === item.key)[0]
                this.editingKey = ''
                if (target) {
                    Object.assign(target, this.cacheData.filter(item => key === item.key)[0])
                    delete target.editable
                    this.data = newData
                }
            }
        },
        beforeDestroy() {
            //  clearTimeout(this.timer)
        }
    }
</script>

<style lang="less" scoped>
    .stepFormText {
        margin-bottom: 24px;

        .ant-form-item-label,
        .ant-form-item-control {
            line-height: 22px;
        }
    }
</style>
```

2、编写后端服务

EstateController.java

```java
package com.bjmsb.controller;

import com.alibaba.fastjson.JSONObject;
import com.bjmsb.bean.FcBuilding;
import com.bjmsb.bean.FcEstate;
import com.bjmsb.json.Common;
import com.bjmsb.service.EstateService;
import com.bjmsb.service.common.FcEstateService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
//@CrossOrigin(origins = "*",allowCredentials="true",allowedHeaders = "*",methods = {})
public class EstateController {

    @Autowired
    private EstateService estateService;

    @RequestMapping("/estate/selectCompany")
    public JSONObject selectCompany(){
        System.out.println("/estate/selectCompany");
        List<String> tblCompanyNames = estateService.selectCompany();
        return JSONObject.parseObject(JSONObject.toJSONString(new Common(tblCompanyNames)));
    }

    @RequestMapping("/estate/insertEstate")
    public JSONObject insertEstate(FcEstate fcEstate){
        System.out.println("insert estate");
        Integer integer = estateService.insertEstate(fcEstate);
        return JSONObject.parseObject(JSONObject.toJSONString(new Common("插入房产成功")));
    }

    @RequestMapping("/estate/selectBuilding")
    public JSONObject selectBuilding(Integer buildingNumber,String estateCode){
        List<FcBuilding> fcBuildings = estateService.selectBuilding(buildingNumber, estateCode);
        for (FcBuilding fcBuilding : fcBuildings) {
            System.out.println(fcBuilding.getId());
        }
        return JSONObject.parseObject(JSONObject.toJSONString(new Common(fcBuildings)));
    }
}
```

EstateService.java

```java
package com.bjmsb.service;

import com.bjmsb.bean.FcBuilding;
import com.bjmsb.bean.FcEstate;
import com.bjmsb.bean.TblCompany;
import com.bjmsb.mapper.FcBuildingMapper;
import com.bjmsb.mapper.FcEstateMapper;
import com.bjmsb.mapper.TblCompanyMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;

@Service
public class EstateService {

    @Autowired
    private TblCompanyMapper tblCompanyMapper;

    @Autowired
    private FcEstateMapper fcEstateMapper;
    @Autowired
    private FcBuildingMapper fcBuildingMapper;

    public List<String> selectCompany(){
        List<String> tblCompanies = tblCompanyMapper.selectCompany();
        return tblCompanies;
    }

    public Integer insertEstate(FcEstate fcEstate){
        int insert = fcEstateMapper.insert(fcEstate);
        return insert;
    }

    /**
     * 在进行查询之前，因为数据库中没有原始数据，因此需要用户先插入数据然后再将数据回显更新
     * @param buildingNumber
     * @param estaeCode
     * @return
     */
    public List<FcBuilding> selectBuilding(Integer buildingNumber,String estaeCode ){
        //定义返回的数据集合
        List<FcBuilding> fcBuildings = new ArrayList<>();
        //创建插入的对象
        //插入数据,完成数据插入之后，id会直接回显，因此直接显式即可
        for(int i = 0;i<buildingNumber;i++){
            FcBuilding fcBuilding = new FcBuilding();
            fcBuilding.setEstateCode(estaeCode);
            fcBuildingMapper.insert(fcBuilding);
            fcBuildings.add(fcBuilding);
        }
        return fcBuildings;
    }
}

```

当每行数据修改完成之后点击保存，将数据更新到数据库，下面开始写前端逻辑

```vue
<template>
    <div>
        <a-row class="header">
            楼宇数量:
            <span style="color: blue;font-weight: 700;">{{ this.$store.state.oneStep.buildingNumber }}</span>
            <!--            单元数量:-->
            <!--            <a-select v-model="form2.region">-->
            <!--                <a-select-option value="1">1</a-select-option>-->
            <!--                <a-select-option value="2">2</a-select-option>-->
            <!--                <a-select-option value="3">3</a-select-option>-->
            <!--                <a-select-option value="4">4</a-select-option>-->
            <!--                <a-select-option value="5">5</a-select-option>-->
            <!--            </a-select>-->
            <!-- </a-form-model-item> -->
        </a-row>
        <a-row>
            <a-table :columns="columns" :dataSource="data" bordered align="center">
                <template
                    v-for="col in [
            'buildingCode',
            'buildingName',
            'unitCount',
            'overRoofDate',
            'finishDate',
            'salePermissionId',
            'buildPermissionId',
            'buildArea',
            'usedArea',
            'remark'
          ]"
                    :slot="col"
                    slot-scope="text, record"
                >
                    <div :key="col">
                        <a-input
                            v-if="record.editable"
                            style="margin: -5px 0"
                            :value="text"
                            @change="e => handleChange(e.target.value, record.key, col)"
                        />
                        <template v-else>{{ text }}</template>
                    </div>
                </template>
                <template slot="operation" slot-scope="text, record">
                    <div class="editable-row-operations">
            <span v-if="record.editable">
              <a @click="() => save(record.key)">保存</a>
              <a-popconfirm title="确认取消吗?" @confirm="() => cancel(record.key)">
                <a>取消</a>
              </a-popconfirm>
            </span>
                        <span v-else>
              <a :disabled="editingKey !== ''" @click="() => edit(record.key)">编辑</a>
            </span>
                    </div>
                </template>
            </a-table>
            <a-row>
                <a-button type="primary" @click="nextStep()">下一步</a-button>
            </a-row>
        </a-row>
    </div>
</template>

<script>
    import { selectBuilding, updateBuilding } from '@/api/estate'
    // import moment from 'moment'
    const QS = require('qs')
    const columns = [
        {
            align: 'center',
            title: '楼宇编码',
            dataIndex: 'buildingCode',
            width: '6%',
            scopedSlots: { customRender: 'buildingCode' }
        },
        {
            align: 'center',
            title: '楼宇名称',
            dataIndex: 'buildingName',
            width: '15%',
            scopedSlots: { customRender: 'buildingName' }
        },
        {
            align: 'center',
            title: '单元数量',
            dataIndex: 'unitCount',
            width: '6%',
            scopedSlots: { customRender: 'unitCount' }
        },
        {
            align: 'center',
            title: '封顶日期',
            dataIndex: 'overRoofDate',
            width: '7%',
            scopedSlots: { customRender: 'overRoofDate' }
        },
        {
            align: 'center',
            title: '竣工日期',
            dataIndex: 'finishDate',
            width: '7%',
            scopedSlots: { customRender: 'finishDate' }
        },
        {
            align: 'center',
            title: '预售许可证',
            dataIndex: 'salePermissionId',
            width: '7%',
            scopedSlots: { customRender: 'salePermissionId' }
        },
        {
            align: 'center',
            title: '建筑许可证',
            dataIndex: 'buildPermissionId',
            width: '7%',
            scopedSlots: { customRender: 'buildPermissionId' }
        },
        {
            align: 'center',
            title: '建筑面积',
            dataIndex: 'buildArea',
            width: '6%',
            scopedSlots: { customRender: 'buildArea' }
        },
        {
            align: 'center',
            title: '使用面积',
            dataIndex: 'usedArea',
            width: '6%',
            scopedSlots: { customRender: 'usedArea' }
        },
        {
            align: 'center',
            title: '备注',
            dataIndex: 'remark',
            width: '10%',
            scopedSlots: { customRender: 'remark' }
        },
        {
            align: 'center',
            title: '编辑',
            width: '4%',
            dataIndex: 'operation',
            scopedSlots: { customRender: 'operation' }
        }
    ]

    const data = []
    export default {
        name: 'Step2',
        data() {
            return {
                labelCol: { span: 2 },
                wrapperCol: { span: 1 },
                form2: {
                    name: '',
                    region: undefined,
                    date1: undefined,
                    delivery: false,
                    type: [],
                    resource: '',
                    desc: ''
                },
                data,
                columns,
                editingKey: ''
                // labelCol: { lg: { span: 5 }, sm: { span: 5 } },
                // wrapperCol: { lg: { span: 19 }, sm: { span: 19 } },
                // form: this.$form.createForm(this),
                // loading: false,
                // timer: 0
            }
        },
        created() {
            const allData = {
                buildingNumber: this.$store.state.oneStep.buildingNumber,
                estateCode: this.$store.state.oneStep.estateCode
            }
            const params = QS.stringify(allData)
            selectBuilding(params).then(res => {
                const result = res.result
                for (let i = 0; i < result.length; i++) {
                    const building = result[i]
                    data.push({
                        key: building.id.toString(),
                        buildingCode: building.buildingCode,
                        buildingName: building.buildingName,
                        unitCount: building.unitCount,
                        overRoofDate: building.overRoofDate,
                        finishDate: building.finishDate,
                        salePermissionId: building.salePermissionId,
                        buildPermissionId: building.buildPermissionId,
                        buildArea: building.buildArea,
                        usedArea: building.usedArea,
                        remark: building.remark
                    })
                }
                this.cacheData = data.map(item => ({ ...item }))
            }).catch(err => {
                this.$notification['error']({
                    message: '错误',
                    description: ((err.response || {}).data || {}).message || '获取楼宇信息失败',
                    duration: 4
                })
            })
        },
        methods: {
            nextStep() {
                this.$emit('nextStep')
            },
            prevStep() {
                // this.$emit('prevStep')
            },
            handleChange(value, key, column) {
                const newData = [...this.data]
                const target = newData.filter(item => key === item.key)[0]
                if (target) {
                    target[column] = value
                    this.data = newData
                }
            },
            edit(key) {
                const newData = [...this.data]
                const target = newData.filter(item => key === item.key)[0]
                this.editingKey = key
                if (target) {
                    target.editable = true
                    this.data = newData
                    this.editingKey = ''
                }
            },
            save(key) {
                const newData = [...this.data]
                const newCacheData = [...this.cacheData]
                const target = newData.filter(item => key === item.key)[0]
                const targetCache = newCacheData.filter(item => key === item.key)[0]
                if (target && targetCache) {
                    delete target.editable
                    this.data = newData
                    Object.assign(targetCache, target)
                    this.cacheData = newCacheData
                }
                target.id = key
                target.estateCode = this.$store.state.oneStep.estateCode
                const param = QS.stringify(target)
                updateBuilding(param).then(res => {
                    setTimeout(() => {
                        this.$notification.success({
                            message: '恭喜你',
                            description: res.result
                        })
                    }, 1000)
                }).catch(err => {
                    this.$notification.error({
                        message: 'error',
                        description: ((err.response || {}).data || {}).message || '添加楼宇信息失败',
                        duration: 1
                    })
                })
            },
            cancel(key) {
                const newData = [...this.data]
                const target = newData.filter(item => key === item.key)[0]
                this.editingKey = ''
                if (target) {
                    Object.assign(target, this.cacheData.filter(item => key === item.key)[0])
                    delete target.editable
                    this.data = newData
                }
            }
        },
        beforeDestroy() {
            //  clearTimeout(this.timer)
        }
    }
</script>

<style lang="less" scoped>
    .stepFormText {
        margin-bottom: 24px;

        .ant-form-item-label,
        .ant-form-item-control {
            line-height: 22px;
        }
    }
</style>

```

编写后端逻辑

EstateController.java

```java
package com.bjmsb.controller;

import com.alibaba.fastjson.JSONObject;
import com.bjmsb.bean.FcBuilding;
import com.bjmsb.bean.FcEstate;
import com.bjmsb.json.Common;
import com.bjmsb.service.EstateService;
import com.bjmsb.service.common.FcEstateService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
//@CrossOrigin(origins = "*",allowCredentials="true",allowedHeaders = "*",methods = {})
public class EstateController {

    @Autowired
    private EstateService estateService;

    @RequestMapping("/estate/selectCompany")
    public JSONObject selectCompany(){
        System.out.println("/estate/selectCompany");
        List<String> tblCompanyNames = estateService.selectCompany();
        return JSONObject.parseObject(JSONObject.toJSONString(new Common(tblCompanyNames)));
    }

    @RequestMapping("/estate/insertEstate")
    public JSONObject insertEstate(FcEstate fcEstate){
        System.out.println("insert estate");
        Integer integer = estateService.insertEstate(fcEstate);
        return JSONObject.parseObject(JSONObject.toJSONString(new Common("插入房产成功")));
    }

    @RequestMapping("/estate/selectBuilding")
    public JSONObject selectBuilding(Integer buildingNumber,String estateCode){
        List<FcBuilding> fcBuildings = estateService.selectBuilding(buildingNumber, estateCode);
        for (FcBuilding fcBuilding : fcBuildings) {
            System.out.println(fcBuilding.getId());
        }
        return JSONObject.parseObject(JSONObject.toJSONString(new Common(fcBuildings)));
    }

    @RequestMapping("/estate/updateBuilding")
    public JSONObject updateBuilding(FcBuilding fcBuilding){
        System.out.println("update building");
        System.out.println(fcBuilding);
        Integer update = estateService.updateBuilding(fcBuilding);
        System.out.println(update);
        return JSONObject.parseObject(JSONObject.toJSONString(new Common("插入楼宇成功")));
    }
}
```

EstateService.java

```java
package com.bjmsb.service;

import com.bjmsb.bean.FcBuilding;
import com.bjmsb.bean.FcEstate;
import com.bjmsb.bean.TblCompany;
import com.bjmsb.mapper.FcBuildingMapper;
import com.bjmsb.mapper.FcEstateMapper;
import com.bjmsb.mapper.TblCompanyMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;

@Service
public class EstateService {

    @Autowired
    private TblCompanyMapper tblCompanyMapper;
    @Autowired
    private FcEstateMapper fcEstateMapper;
    @Autowired
    private FcBuildingMapper fcBuildingMapper;

    public List<String> selectCompany(){
        List<String> tblCompanies = tblCompanyMapper.selectCompany();
        return tblCompanies;
    }

    public Integer insertEstate(FcEstate fcEstate){
        int insert = fcEstateMapper.insert(fcEstate);
        return insert;
    }

    /**
     * 在进行查询之前，因为数据库中没有原始数据，因此需要用户先插入数据然后再将数据回显更新
     * @param buildingNumber
     * @param estaeCode
     * @return
     */
    public List<FcBuilding> selectBuilding(Integer buildingNumber,String estaeCode ){
        //定义返回的数据集合
        List<FcBuilding> fcBuildings = new ArrayList<>();
        //创建插入的对象
        //插入数据,完成数据插入之后，id会直接回显，因此直接显式即可
        for(int i = 0;i<buildingNumber;i++){
            FcBuilding fcBuilding = new FcBuilding();
            fcBuilding.setEstateCode(estaeCode);
            fcBuildingMapper.insert(fcBuilding);
            fcBuilding.setBuildingCode("B"+fcBuilding.getId());
            fcBuilding.setBuildingName("第"+(i+1)+"号楼");
            fcBuildings.add(fcBuilding);
        }
        return fcBuildings;
    }

    public Integer updateBuilding(FcBuilding fcBuilding){
        int update = fcBuildingMapper.updateById(fcBuilding);
        return update;
    }
}
```

### 4、Step2-Step3数据传递问题：

​		跟之前的数据传递一样，此时我们也需要进行数据的传递，那么怎么来完成呢？看代码实操

1、在Step2跳转之前添加如下 代码

```js
nextStep() {
                const dataArray = this.data
                var param = '['
                for (let i = 0; i < dataArray.length; i++) {
                    if (i !== dataArray.length - 1) {
                        param += '{ buildingCode: ' + dataArray[i].buildingCode + ', unitCount: ' + dataArray[i].unitCount + '},'
                    } else {
                        param += '{ buildingCode: ' + dataArray[i].buildingCode + ', unitCount: ' + dataArray[i].unitCount + '}]'
                    }
                }
                this.$store.commit('SET_TITLE', {
                    unitMessage: param
                })
                this.$emit('nextStep')
            },
```

2、添加twoStep.js文件在src\store\modules目录下

```js
const twoStep = {
    state: {
        unitMessage: []
    },
    mutations: {
        // 这里只能是同步的
        SET_TITLE(state, payload) {
            console.log(payload)
            state.unitMessage = payload.unitMessage
        }
    },
    actions: {

    },
    getters: {

    }
}
export default twoStep
```

3、在同样目录的index.js文件中添加如下代码：

```js
import Vue from 'vue'
import Vuex from 'vuex'

import app from './modules/app'
import user from './modules/user'
// default router permission control
import permission from './modules/permission'
import oneStep from './modules/oneStep'
import twoStep from './modules/twoStep'
// dynamic router permission control (Experimental)
// import permission from './modules/async-router'
import getters from './getters'

Vue.use(Vuex)

export default new Vuex.Store({
  modules: {
    app,
    user,
    permission,
    oneStep,
    twoStep
  },
  state: {

  },
  mutations: {

  },
  actions: {

  },
  getters
})
```

4、在Step3.vue中使用之前传递过来的参数：

```js
{{ this.$store.state.twoStep.unitMessage }}
```

### 5、新增住宅向导-Step3

​		下面开始完成Step3的功能，其实跟之前的操作差不多，干他！！！

1、编写前端页面

```js
<template>
  <div>
    <!-- <a-form-model ref="ruleForm" :model="form2" :label-col="labelCol" :wrapper-col="wrapperCol"> -->
    <a-row class="header">
      楼层数量:
      <a-input style="width: 30px;padding: 0;text-align: center;" @blur="changeFloor()" v-model="form2.floorNumber"></a-input>开始房号:
      <!-- <a-form-model-item label="单元数量：" prop="region" class="units" :labelCol="labelCol" :wrapperCol="wrapperCol"> -->
      <a-select v-model="form2.startCell" @change="changeStartCell()">
        <a-select-option value="1">1</a-select-option>
        <a-select-option value="2">2</a-select-option>
        <a-select-option value="3">3</a-select-option>
        <a-select-option value="4">4</a-select-option>
        <a-select-option value="5">5</a-select-option>
        <a-select-option value="6">6</a-select-option>
        <a-select-option value="7">7</a-select-option>
        <a-select-option value="8">8</a-select-option>
      </a-select>结束房号:
      <!-- <a-form-model-item label="单元数量：" prop="region" class="units" :labelCol="labelCol" :wrapperCol="wrapperCol"> -->
      <a-select v-model="form2.stopCell" @change="changeStopCell()">
        <a-select-option value="1">1</a-select-option>
        <a-select-option value="2">2</a-select-option>
        <a-select-option value="3">3</a-select-option>
        <a-select-option value="4">4</a-select-option>
        <a-select-option value="5">5</a-select-option>
        <a-select-option value="6">6</a-select-option>
        <a-select-option value="7">7</a-select-option>
        <a-select-option value="8">8</a-select-option>

      </a-select>
      <!-- </a-form-model-item> -->
    </a-row>
    <a-row>
      <a-table :columns="columns" :dataSource="data" bordered align="center">
        <template
          v-for="col in [
            'buildingCode',
            'unitCode',
            'unitName',
            'startFloor',
            'stopFloor',
            'startCellId',
            'stopCellId',
            'remark'
          ]"
          :slot="col"
          slot-scope="text, record"
        >
          <div :key="col">
            <a-input
              v-if="record.editable"
              style="margin: -5px 0"
              :value="text"
              @change="e => handleChange(e.target.value, record.key, col)"
            />
            <template v-else>{{ text }}</template>
          </div>
        </template>
        <template slot="operation" slot-scope="text, record">
          <div class="editable-row-operations">
            <span v-if="record.editable">
              <a @click="() => save(record.key)">保存</a>&nbsp;
              <a-popconfirm title="确认取消吗?" @confirm="() => cancel(record.key)">
                <a>取消</a>
              </a-popconfirm>
            </span>
            <span v-else>
              <a :disabled="editingKey !== ''" @click="() => edit(record.key)">编辑</a>
            </span>
          </div>
        </template>
      </a-table>
      <a-row>
        <a-button type="primary" @click="nextStep()">下一步</a-button>
      </a-row>
    </a-row>
  </div>
</template>

<script>
    import { selectUnit, updateUnit } from '@/api/estate'
const QS = require('qs')
const columns = [
    {
        // 楼宇编码	单元编码	单元名称	开始楼层	结束楼层	开始房号	结束房号
        align: 'center',
        title: '楼宇编码',
        dataIndex: 'buildingCode',
        width: '6%',
        scopedSlots: { customRender: 'buildingCode' }
    },
    {
        align: 'center',
        title: '单元编码',
        dataIndex: 'unitCode',
        width: '6%',
        scopedSlots: { customRender: 'unitCode' }
    },
    {
        align: 'center',
        title: '单元名称',
        dataIndex: 'unitName',
        width: '6%',
        scopedSlots: { customRender: 'unitName' }
    },
    {
        align: 'center',
        title: '开始楼层',
        dataIndex: 'startFloor',
        width: '7%',
        scopedSlots: { customRender: 'startFloor' }
    },
    {
        align: 'center',
        title: '结束楼层',
        dataIndex: 'stopFloor',
        width: '7%',
        scopedSlots: { customRender: 'stopFloor' }
    },
    {
        align: 'center',
        title: '开始房号',
        dataIndex: 'startCellId',
        width: '7%',
        scopedSlots: { customRender: 'startCellId' }
    },
    {
        align: 'center',
        title: '结束房号',
        dataIndex: 'stopCellId',
        width: '7%',
        scopedSlots: { customRender: 'stopCellId' }
    },
    {
        align: 'center',
        title: '备注',
        dataIndex: 'remark',
        width: '18%',
        scopedSlots: { customRender: 'remark' }
    },
    {
        align: 'center',
        title: '编辑',
        width: '7%',
        dataIndex: 'operation',
        scopedSlots: { customRender: 'operation' }
    }
]

const data = []
export default {
    name: 'Step3',
    data() {
        return {
            labelCol: { span: 2 },
            wrapperCol: { span: 1 },
            form2: {
                name: '',
                startCell: '',
                stopCell: '',
                date1: undefined,
                delivery: false,
                type: [],
                resource: '',
                floorNumber: '',
                desc: ''
            },
            data,
            columns,
            editingKey: ''
        }
    },created() {
        selectUnit( this.$store.state.twoStep.unitMessage ).then(res => {
            const result = res.result
            for (let i = 0; i < result.length; i++) {
                const unit = result[i]
                data.push({
                    key: unit.id.toString(),
                    buildingCode: unit.buildingCode,
                    unitCode: unit.unitCode,
                    unitName: unit.unitName,
                    startFloor: unit.startFloor,
                    stopFloor: unit.stopFloor,
                    startCellId: unit.startCellId,
                    stopCellId: unit.stopCellId,
                    remark: unit.remark
                })
            }
            this.cacheData = data.map(item => ({ ...item }))
        }).catch(err => {
            this.$notification['error']({
                message: '错误',
                description: ((err.response || {}).data || {}).message || '获取单元数据',
                duration: 4
            })
        })
    },
    methods: {
        changeFloor(){
            const floorNumber = this.form2.floorNumber
            for (let i = 0; i < this.data.length; i++) {
                this.data[i].startFloor = 1
                this.data[i].stopFloor = floorNumber
            }
        },
        changeStartCell(){
            const startCell = this.form2.startCell
            for (let i = 0; i < this.data.length; i++) {
                this.data[i].startCellId = startCell
            }
        },
        changeStopCell(){
            const stopCell = this.form2.stopCell
            for (let i = 0; i < this.data.length; i++) {
                this.data[i].stopCellId = stopCell
            }
        },
        nextStep() {
            this.$emit('nextStep')
        },
        prevStep() {
            // this.$emit('prevStep')
        },
        handleChange(value, key, column) {
            const newData = [...this.data]
            const target = newData.filter(item => key === item.key)[0]
            if (target) {
                target[column] = value
                this.data = newData
            }
        },
        edit(key) {
            const newData = [...this.data]
            const target = newData.filter(item => key === item.key)[0]
            this.editingKey = key
            if (target) {
                target.editable = true
                this.data = newData
            }
        },
        save(key) {
            console.log(key)
            const newData = [...this.data]
            const newCacheData = [...this.cacheData]
            const target = newData.filter(item => key === item.key)[0]
            const targetCache = newCacheData.filter(item => key === item.key)[0]
            if (target && targetCache) {
                delete target.editable
                this.data = newData
                Object.assign(targetCache, target)
                this.cacheData = newCacheData
                this.editingKey = ''
            }
            target.id = key
            const param = QS.stringify(target)
            updateUnit(param).then(res => {
                setTimeout(() => {
                    this.$notification.success({
                        message: '恭喜你',
                        description: res.result
                    })
                }, 1000)
            }).catch(err => {
                this.$notification.error({
                    message: 'error',
                    description: ((err.response || {}).data || {}).message || '添加单元信息失败',
                    duration: 1
                })
            })
        },
        cancel(key) {
            const newData = [...this.data]
            const target = newData.filter(item => key === item.key)[0]
            this.editingKey = ''
            if (target) {
                Object.assign(target, this.cacheData.filter(item => key === item.key)[0])
                delete target.editable
                this.data = newData
            }
        }
    },
    beforeDestroy() {
        //  clearTimeout(this.timer)
    }
}
</script>

<style lang="less" scoped>
.stepFormText {
    margin-bottom: 24px;

    .ant-form-item-label,
    .ant-form-item-control {
        line-height: 22px;
    }
}
</style>

```

2、编写后端逻辑

UnitMessage.java

```java
package com.bjmsb.vo;

public class UnitMessage {

    private String buildingCode;
    private Integer unitCount;

    public UnitMessage() {
    }

    public UnitMessage(String buildingCode, Integer unitCount) {
        this.buildingCode = buildingCode;
        this.unitCount = unitCount;
    }

    public String getBuildingCode() {
        return buildingCode;
    }

    public void setBuildingCode(String buildingCode) {
        this.buildingCode = buildingCode;
    }

    public Integer getUnitCount() {
        return unitCount;
    }

    public void setUnitCount(Integer unitCount) {
        this.unitCount = unitCount;
    }

    @Override
    public String toString() {
        return "UnitMessage{" +
                "buildingCode='" + buildingCode + '\'' +
                ", unitCount=" + unitCount +
                '}';
    }
}

```

EstateController.java

```java
 @RequestMapping("/estate/selectUnit")
    public JSONObject selectUnit(@RequestBody UnitMessage[] unitMessages){
        System.out.println("selectUnit");
        System.out.println(unitMessages[0]);
        List<FcUnit> allUnit = new ArrayList<>();
        for (UnitMessage unitMessage : unitMessages) {
            allUnit.addAll(estateService.selectUnit(unitMessage));
        }
        System.out.println(allUnit.size());
        return JSONObject.parseObject(JSONObject.toJSONString(new Common(allUnit)));
    }
@RequestMapping("/estate/updateUnit")
    public JSONObject updateUnit(FcUnit fcUnit){
        System.out.println("update unit");
        System.out.println(fcUnit);
        Integer update = estateService.updateUnit(fcUnit);
        System.out.println(update);
        return JSONObject.parseObject(JSONObject.toJSONString(new Common("更新单元成功")));
    }
```

EstateService.java

```java
 /**
     * 此处的逻辑跟上述的逻辑相同，只需要插入对应的数据即可
     * @return
     */
    public List<FcUnit> selectUnit(UnitMessage unitMessage){
        //定义返回的集合
        List<FcUnit> fcUnits = new ArrayList<>();
        //操作插入数据
        for (int i = 0;i<unitMessage.getUnitCount();i++){
            FcUnit fcUnit = new FcUnit();
            fcUnit.setBuildingCode(unitMessage.getBuildingCode());
            fcUnit.setUnitCode("U"+(i+1));
            fcUnit.setUnitName("第"+(i+1)+"单元");
            fcUnitMapper.insert(fcUnit);
            fcUnits.add(fcUnit);
        }
        return fcUnits;
    }
 public Integer updateUnit(FcUnit fcUnit){
        int update = fcUnitMapper.updateById(fcUnit);
        return update;
    }
```

### 6、Step3-Step4数据传递问题

跟之前的数据传递一样，此时我们也需要进行数据的传递，那么怎么来完成呢？看代码实操

1、在Step2跳转之前添加如下 代码

```js
nextStep() {
            const dataArray = this.data
            console.log(dataArray)
            let param = '['
            for (let i = 0; i < dataArray.length; i++) {
                if (i !== dataArray.length - 1) {
                    param += '{ "unitCode": "' + dataArray[i].unitCode + '", "startFloor": ' + dataArray[i].startFloor + '", "stopFloor": ' + dataArray[i].stopFloor + '", "startCellId": ' + dataArray[i].startCellId + '", "stopCellId": ' + dataArray[i].stopCellId + '},'
                } else {
                    param += '{ "unitCode": "' + dataArray[i].unitCode + '", "startFloor": ' + dataArray[i].startFloor + '", "stopFloor": ' + dataArray[i].stopFloor + '", "startCellId": ' + dataArray[i].startCellId + '", "stopCellId": ' + dataArray[i].stopCellId + '}'
                }
            }
            console.log('param:' + param)
            this.$store.commit('SET_TITLE', {
                cellMessage: param
            })
            this.$emit('nextStep')
        },
```

2、添加threeStep.js文件在src\store\modules目录下

```js
const threeStep = {
    state: {
        cellMessage: []
    },
    mutations: {
        // 这里只能是同步的
        SET_TITLE(state, payload) {
            console.log(payload)
            state.cellMessage = payload.cellMessage
        }
    },
    actions: {

    },
    getters: {

    }
}
export default threeStep
```

3、在同样目录的index.js文件中添加如下代码：

```js
import Vue from 'vue'
import Vuex from 'vuex'

import app from './modules/app'
import user from './modules/user'
// default router permission control
import permission from './modules/permission'
import oneStep from './modules/oneStep'
import twoStep from './modules/twoStep'
import threeStep from '@/store/modules/threeStep3'
// dynamic router permission control (Experimental)
// import permission from './modules/async-router'
import getters from './getters'

Vue.use(Vuex)

export default new Vuex.Store({
  modules: {
    app,
    user,
    permission,
    oneStep,
    twoStep,
    threeStep
  },
  state: {

  },
  mutations: {

  },
  actions: {

  },
  getters
})

```

4、在Step4.vue中使用之前传递过来的参数：

```js
{{ this.$store.state.threeStep.cellMessage }}
```

### 